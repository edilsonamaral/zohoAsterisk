; ODBC_SQL - Allow an SQL statement to be built entirely in the dialplan
[SQL]
dsn=mysql1
readsql=${ARG1}

; ODBC_ANTIGF - A blacklist.
[ANTIGF]
dsn=mysql1,mysql2   ; Use mysql1 as the primary handle, but fall back to mysql2
                    ; if mysql1 is down.  Supports up to 5 comma-separated
                    ; DSNs.  "dsn" may also be specified as "readhandle" and
                    ; "writehandle", if it is important to separate reads and
                    ; writes to different databases.
readsql=SELECT COUNT(*) FROM exgirlfriends WHERE callerid='${SQL_ESC(${ARG1})}'
syntax=<callerid>
synopsis=Check if a specified callerid is contained in the ex-gf database

; ODBC_PRESENCE - Retrieve and update presence
[PRESENCE]
dsn=mysql1
readsql=SELECT location FROM presence WHERE id='${SQL_ESC(${ARG1})}'
writesql=UPDATE presence SET location='${SQL_ESC(${VAL1})}' WHERE id='${SQL_ESC(${ARG1})}'

[ADDCNAM]
dsn=asterisk-ODBC
synopsis= Adds new CNAM
readsql=SELECT LAST_INSERT_ID();
writesql=INSERT INTO asterisk.CNAM (cnam_name,cnam_phone,calleddid,accountname) VALUES ('${VAL1}','${VAL2}','${VAL3}','${VAL4}') ON DUPLICATE KEY UPDATE cnam_name='${VAL1}',cnam_phone='${VAL2}',calleddid='${VAL3}',accountname='${VAL4}';

[GETCNAM]
dsn=asterisk-ODBC
synopsis=Check if the number has a CNAM in our DB
readsql=SELECT cnam_name,cnam_phone FROM asterisk.CNAM WHERE cnam_phone like '%${SQL_ESC(${ARG1})}'

[GETMENUOPTION]
dsn=asterisk-ODBC
synopsis=Get main nenu for account
readsql=SELECT menuoption,isPlay,en_greeting_filename,es_greeting_filename,pt_greeting_filename FROM voipuser.didmenus WHERE accountcode = '${SQL_ESC(${ARG1})}' AND menuoption = '${SQL_ESC(${ARG2})}'

[GEVALIDDMENUOPTIONS]
dsn=asterisk-ODBC
synopsis=Get Valid Menu options
mode=multirow
readsql=call voipuser.get_validMenuOptions('${ARG1}','${ARG2}')

[GETDIDFWDTOPHONE]
dsn=asterisk-ODBC
synopsis=Get did ring time when forwarding
readsql=call voipuser.get_FORWARDTOPHONEDAY('${ARG1}','${ARG2}','${ARG3}')

[GETRING_GROUPMEMBERS]
dsn=asterisk-ODBC
synopsis=Get the ring group of extensions.
readsql=call voipuser.spGet_RingGroupMembers('${ARG1}','${ARG2}','${ARG3}','${ARG4}')

[GETRING_GROUPS]
dsn=asterisk-ODBC
synopsis=Get the ring group of extensions .  accountcode and group name
readsql=call voipuser.spGet_RingGroup('${ARG1}','${ARG2}')

[GETDIALGROUPS]
dsn=asterisk-ODBC
synopsis=Get the ring group of extensions.
readsql=SELECT fwdRingGroupTO_1,fwdRingGroupTO_2,fwdRingGroupTO_3,peersingroup1,peersingroup2, peersingroup3 FROM voipuser.RINGGROUPS_VIEW WHERE accountcode = '${SQL_ESC(${ARG1})}' AND did='${SQL_ESC(${ARG2})}'

[GETSCHEDULEEXCEPTION]
dsn=asterisk-ODBC
synopsis=Check if the number dialed is part of the system
readsql=call voipuser.get_schedule_exception('${SQL_ESC(${ARG1})}','${SQL_ESC(${ARG2})}')

[GETAFTERHOURSFILENAME]
dsn=asterisk-ODBC
synopsis=Get afterhours file name
readsql=CALL `voipuser`.`spGet_afterhoursFileName` ('${SQL_ESC(${ARG1})}','${SQL_ESC(${ARG2})}')

[GETCALLERIDNAME]
dsn=asterisk-ODBC
synopsis=Check if the number dialed is part of the system
readsql=call voipuser.get_CallerIDName('${SQL_ESC(${ARG1})}')

[ISINTERNAL]
dsn=asterisk-ODBC
synopsis=Check if the number dialed is part of the system
readsql=SELECT mainextension,accountcode,server,serveraddress,did FROM voipuser.dids WHERE did='${SQL_ESC(${ARG1})}'

[GETDIDSMS]
dsn=asterisk-ODBC
synopsis=Check whether to send sms when forwarding specific DID
readsql=SELECT send_sms_on_fwd,send_sms_on_fwd_ToNumbrs,send_sms_alwaysToNumbrs,send_sms_message,send_sms_company,send_sms_afterhours FROM voipuser.dids WHERE did='${SQL_ESC(${ARG1})}'

[GET_SEND_SMS_AFTERHOURS]
dsn=asterisk-ODBC
synopsis=Check whether to send sms when forwarding specific DID
readsql=SELECT send_sms_afterhours,send_sms_on_fwd_ToNumbrs, gotovmbox1 FROM voipuser.did_profiles WHERE accountcode='${SQL_ESC(${ARG1})}' AND PROFILE_NAME='${SQL_ESC(${ARG2})}'

[GETDEFAULT_VMBOX]
dsn=asterisk-ODBC
synopsis=Check whether to send sms when forwarding specific DID
readsql=call voipuser.get_DefaultVMBox(${ARG1},${ARG2})

[BASICVARS]
dsn=asterisk-ODBC
synopsis= Gets global vars
readsql=SELECT s.localchannels,s.interchannels,s.maincallerid,s.dialprovider1,s.dialprovider2,s.dialprovider3,s.canreqtodialout,s.provider911,s.passoriginalid,s.isenabled,s.interprovider1,s.interprovider2,s.interprovider3,s.mobilerate,s.hasmonitor,s.languageoptionEn,s.languageoptionEs,s.languageoptionPt,brazilprovider1,brazilprovider2,brazilprovider3,can_fwd_ToBr_mobile,allow_sms_out FROM voipuser.services s WHERE accountcode='${SQL_ESC(${ARG1})}' and s.isenabled=1

[GETDOMESTICPROVIDERS]
dsn=asterisk-ODBC
synopsis= Get Providers for domestic calls
readsql=SELECT dialprovider1,dialprovider2,dialprovider3 FROM voipuser.services where accountcode ='${SQL_ESC(${ARG1})}' and isenabled = '1'

[GET0800PROVIDER]
dsn=asterisk-ODBC
synopsis=Check whether to send sms when forwarding specific DID
readsql=SELECT brazil0800provider1 FROM voipuser.services where accountcode ='${SQL_ESC(${ARG1})}' and isenabled = '1'

[GETBRCELLPHONEPROVIDERS]
dsn=asterisk-ODBC
synopsis=Check whether to send sms when forwarding specific DID
readsql=SELECT brazilcellprovider1,brazilcellprovider2,brazilcellprovider3 FROM voipuser.services where accountcode ='${SQL_ESC(${ARG1})}' and isenabled = '1'

[GETSKIPVMGREETING]
dsn=asterisk-ODBC
synopsis= Get skip greeting from voicemail_users
readsql=SELECT skipgreeting,forcegreetingstatus,vm_File_Name,play_vm_File FROM asterisk.voicemail_users WHERE customer_id='${SQL_ESC(${ARG1})}' AND context='${SQL_ESC(${ARG2})}' AND mailbox='${SQL_ESC(${ARG3})}'

[GETATENDEDOR_FILE]
dsn=asterisk-ODBC
synopsis= Get file name to use as atendedor
;; readsql=SELECT atendedor_file,atendedor_directory,playGreetingFor_VM,playatendedor FROM voipuser.dids WHERE accountcode='${SQL_ESC(${ARG1})}' and did='${SQL_ESC(${ARG2})}'
readsql=call voipuser.get_atendedor('${ARG1}','${ARG2}')

[GETDIDMENU]
dsn=asterisk-ODBC
synopsis= Get file name to use as menu
readsql=call voipuser.get_didmenu('${ARG1}','${ARG2}','${ARG3}', '${ARG4}')

[GETDIDONACCOUNT]
dsn=asterisk-ODBC
synopsis=Check if the number dialed is part of the system
readsql=SELECT did FROM voipuser.dids WHERE did='${SQL_ESC(${ARG1})}'

[GETDIDsONACCOUNT]
dsn=asterisk-ODBC
mode=multirow   ;;  MULTIROW
synopsis=Check if the number dialed is part of the system
readsql=SELECT did FROM voipuser.dids WHERE accountcode='${SQL_ESC(${ARG1})}'

[DIDDATA]
dsn=asterisk-ODBC
synopsis=Get the DID
readsql=call voipuser.get_DIDDATA('${ARG1}')

[GETEXTGROUPS]
dsn=asterisk-ODBC
synopsis=Get the group of extensions
readsql=call voipuser.GETEXTGROUPS('${ARG1}','${ARG2}')

[FORWARDTOPHONEDAY]
dsn=asterisk-ODBC
synopsis=Check
readsql=SELECT trim(fwdph1),trim(fwdph2),trim(fwdph3),fwd1rgtime,fwd2rgtime,fwd3rgtime,fwd1enabled,fwd2enabled,fwd3enabled,didnumber FROM voipuser.forwardtoDay WHERE accountcode='${SQL_ESC(${ARG1})}' AND didnumber like '%${SQL_ESC(${ARG2})}%'

[FORWARDTOPHONENIGHT]
dsn=asterisk-ODBC
synopsis=Check night schedule
readsql=SELECT fwdph1,fwdph2,fwdph3,fwd1rgtime,fwd2rgtime,fwd3rgtime,fwd1enabled,fwd2enabled,fwd3enabled,didnumber FROM voipuser.forwardtoNight WHERE accountcode='${SQL_ESC(${ARG1})}' AND didnumber like '%${SQL_ESC(${ARG2})}%'

[ISALLOWEDCOUNTRY]
dsn=asterisk-ODBC
synopsis=Check
readsql=SELECT COUNT(*) as isvalid FROM voipuser.services where accountcode='${ARG1}' AND (allowedcountrycode LIKE '%${ARG2}%' OR allowedcountrycode LIKE '%*%')

[GETRATE]
dsn=asterisk-ODBC
synopsis=Retrieve rate  of the call per minute
readsql=SELECT col_description,col_rate,col_rate_premium,provider FROM voipuser.callrates where provider='${ARG1}' AND col_prefix LIKE '${ARG2}%'

[GETSCHEDULE]
dsn=asterisk-ODBC
synopsis=Retrieve schedule from database
readsql=call voipuser.get_SCHEDULE('${ARG1}','${ARG2}','${ARG3}', '${ARG4}')

[GETSCHEDULETIME]
dsn=asterisk-ODBC
synopsis=Retrieve schedule from database
readsql=call voipuser.get_SCHEDULE_TIME('${ARG1}','${ARG2}','${ARG3}')

[SETOVERRIDE]
dsn=asterisk-ODBC
synopsis=Set or disable override
readsql=call voipuser.changeOverride(${ARG1},'${ARG2}','${ARG3}')

[GETPHONEACCESS]
dsn=asterisk-ODBC
synopsis=Get phone access passcode
readsql=SELECT password,authorizedcallerid1,authorizedcallerid2,did,validateperpass FROM voipuser.phoneaccess WHERE accountname='${ARG1}'

[GETDIALOUT]
dsn=asterisk-ODBC
synopsis=Get dial out
readsql= call voipuser.get_DIALOUT('${ARG1}')

[GETTRANSFERTO]
dsn=asterisk-ODBC
synopsis= Get the extension to be transfered 
readsql=SELECT transferto,dialoutcallerid,ringtime FROM asterisk.sip_buddies WHERE name='${ARG1}'

[GETPEERINFO]
dsn=asterisk-ODBC
synopsis= Get the extension info
readsql=call asterisk.getpeerinfo('${ARG1}')

[SETTRANSFERTO]
dsn=asterisk-ODBC
synopsis= From the phone user can program to transfer to another number
readsql=call asterisk.transferto(${ARG1},'${ARG2}')

[GETMENUOPTIONS]
dsn=asterisk-ODBC
synopsis= From the phone user can program to transfer to another number
readsql=SELECT optionName1,optionName2,optionName3,optionName4,optionName5 FROM voipuser.dids WHERE did='${ARG1}'

[GETAUTHORIZEDCALLEDID]
dsn=asterisk-ODBC
synopsis= Finds out whether the callerid is authorized to make calls on the calling card system, GETS the card with the most balance
readsql=SELECT id,MAX(balance) FROM voipuser.callingcards WHERE authorizedcallerid='${ARG1}'

[GETCALLINGCARDBYCODE]
dsn=asterisk-ODBC
synopsis= Gets the calling card with code
readsql=SELECT id FROM voipuser.callingcards WHERE '${ARG1}' IN (REPLACE(code,'-',''),code)

[GETCALLINGARDBYID]
dsn=asterisk-ODBC
synopsis= Gets the calling card with code ---- soma-se "facevalue/rateperminute)" com o select do cdr porq o resultado do cdr ja eh negativo
readsql=SELECT id,rateperminute,firstusedate,isinuse,balance,celphonerate,COALESCE((ABS(DATEDIFF(firstusedate,NOW())) > 30),0) as expired,type,serial FROM voipuser.callingcards WHERE id=${ARG1}

[SETCALLINGCARDFIRSTUSE]
dsn=asterisk-ODBC
synopsis= Sets the calling card first start time
writesql=UPDATE voipuser.callingcards set firstusedate=NOW(),lastusedate=NOW(),isinuse=1 where id=${ARG1}

[SETCALLINGCARDSTARTCALL]
dsn=asterisk-ODBC
synopsis= Sets the calling card start time
writesql=UPDATE voipuser.callingcards set lastusedate=NOW(),isinuse=1 where id=${VAL1}

[CREATECALLINGCARDCDR]
dsn=asterisk-ODBC
synopsis= Sets the calling card cdr
readsql=SELECT LAST_INSERT_ID();
writesql=INSERT INTO voipuser.callingcard_cdr (cardid,start_calldate,destination,rate,did,callerid,serial) VALUES (${VAL1},NOW(),${VAL2},${VAL3},${VAL4},${VAL5},'${VAL6}');

[SETCALLINGCARDENDOFCALL]
dsn=asterisk-ODBC
synopsis= Sets the calling card cdr
writesql=UPDATE voipuser.callingcards set isinuse=0,lastusedate=NOW(),balance=${VAL1} where id=${VAL2};

[GETCALLINGCARD_REMAININGBALANCE]
dsn=asterisk-ODBC
synopsis= Sets the calling card cdr
readsql=SELECT facevalue+COALESCE((SELECT SUM(FLOOR(TIME_TO_SEC(TIMEDIFF(start_calldate,end_calldate))/60)*rate) FROM voipuser.callingcard_cdr where cardid=${ARG1}),0) as b FROM voipuser.callingcards where id=${ARG1};

[SETCALLINGCARD_CDR_ENDOFCALL]
dsn=asterisk-ODBC
synopsis= Sets the calling card cdr end of call
writesql=UPDATE voipuser.callingcard_cdr set end_calldate=NOW() where id=${VAL1};

[REMOVECALLINGCARDAUTHORIZATION]
dsn=asterisk-ODBC
synopsis= Sets the calling card cdr end of call
writesql=UPDATE voipuser.callingcards set authorizedcallerid=0 where id=${VAL1};

[SETCALLINGCARDCADASTRO]
dsn=asterisk-ODBC
synopsis= Sets cadastro
writesql=UPDATE voipuser.callingcards set authorizedcallerid=${VAL1} where id=${ARG1};

[GETPEER911PROVIDER]
dsn=asterisk-ODBC
synopsis= Get the 911 provider 
readsql=call asterisk.get911provider('${ARG1}')

[GETDIDOFFENDER]
dsn=asterisk-ODBC
synopsis= Get 1 if did is on the offenders list
readsql=call voipuser.spGetSetdidBlocks('${ARG1}', '${SQL_ESC(${ARG2})}')

[GETAUDIOHASH]
dsn=asterisk-ODBC
synopsis= Gets the MD5 hash for the audio file
readsql=SELECT md5_hash FROM voipuser.audiogreetings WHERE accountcode='${ARG1}' AND name='${ARG2}';

[GETPROFILE]
dsn=asterisk-ODBC
synopsis= Gets the profile on account
readsql=call voipuser.get_profile('${ARG1}', '${ARG2}');

[GET_ISCUSTOMER]
dsn=asterisk-ODBC
synopsis= Sets the calling card cdr
readsql=SELECT accountcode from voipuser.services where accountcode='${ARG1}';

[GETPROFILEMENU]
dsn=asterisk-ODBC
synopsis= Gets the profile on account
readsql=call voipuser.get_profile_menu('%${SQL_ESC(${ARG1})}', '%${SQL_ESC(${ARG2})}');
 
[GETDIDMENUOPTION]
dsn=asterisk-ODBC
synopsis= Gets the profile on account
readsql=call voipuser.get_DIDMENUSOPTION('${ARG1}', '${ARG2}', '${ARG3}', '${ARG4}', '${ARG5}');
